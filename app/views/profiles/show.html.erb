<% content_for :body_class, "profile-page" %>

<div class="container-xl">
  <p class="text-uppercase text-secondary fw-semibold small mb-1"><%= t("profiles.eyebrow") %></p>
  <h1 class="display-5 fw-bold mb-2"><%= t("profiles.title") %></h1>
  <p class="text-muted mb-4"><%= t("profiles.subtitle") %></p>

  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column h-100">
          <div class="mb-4 pb-4 border-bottom">
            <h2 class="h5 mb-3"><%= t("profiles.account.heading") %></h2>
            <p class="text-muted small mb-4"><%= t("profiles.account.description") %></p>

            <%= form_with model: current_user, url: profile_path, method: :patch, local: true do |f| %>
              <div class="mb-3">
                <%= f.label :email, t("profiles.account.email"), class: "form-label" %>
                <%= f.email_field :email, class: "form-control", required: true %>
              </div>

              <div class="mb-3">
                <%= f.label :preferred_language, t("profiles.account.preferred_language"), class: "form-label" %>
                <%= f.select :preferred_language, language_options_for_select, { selected: current_user.preferred_language }, class: "form-select" %>
              </div>

              <%= f.submit t("profiles.account.save"), class: "btn btn-primary" %>
            <% end %>
          </div>

          <div class="mt-auto">
            <h2 class="h5 mb-3"><%= t("profiles.password.heading") %></h2>
            <p class="text-muted small mb-4"><%= t("profiles.password.description") %></p>
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
              <div class="text-muted small"><%= t("profiles.password.cta_hint") %></div>
              <%= button_to t("profiles.password.send_reset"), send_reset_password_profile_path, method: :post, class: "btn btn-outline-primary" %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h5 mb-3"><%= t("profiles.oauth.heading") %></h2>
          <p class="text-muted small mb-4"><%= t("profiles.oauth.description") %></p>

          <% oauth_providers = {
            "google_oauth2" => { icon: "fab fa-google", label: t("profiles.oauth.google") },
            "facebook" => { icon: "fab fa-facebook", label: t("profiles.oauth.facebook") },
            "twitter2" => { icon: "fab fa-twitter", label: t("profiles.oauth.twitter") }
          } %>

          <% oauth_providers.each do |provider, meta| %>
            <div class="d-flex align-items-center justify-content-between border rounded p-3 mb-3">
              <div class="d-flex align-items-center gap-3">
                <i class="<%= meta[:icon] %> text-primary fs-4" aria-hidden="true"></i>
                <div>
                  <div class="fw-semibold"><%= meta[:label] %></div>
                  <div class="text-muted small">
                    <% if connected_provider?(provider) %>
                      <%= t("profiles.oauth.connected") %>
                    <% else %>
                      <%= t("profiles.oauth.disconnected") %>
                    <% end %>
                  </div>
                </div>
              </div>
              <div class="d-flex gap-2">
                <% if connected_provider?(provider) %>
                  <%= button_to t("profiles.oauth.disconnect"), disconnect_oauth_profile_path(provider: provider), method: :delete, class: "btn btn-outline-danger btn-sm", data: { confirm: t("profiles.oauth.disconnect_confirm", provider: meta[:label]) } %>
                <% else %>
                  <%= link_to t("profiles.oauth.connect"), oauth_authorize_path(provider), class: "btn btn-outline-primary btn-sm" %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
