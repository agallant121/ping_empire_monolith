<%= turbo_frame_tag "website_list" do %>
  <section class="surface-block mt-4">
    <div class="row g-4">
      <% if websites.blank? %>
        <div class="col-12">
          <p class="surface-subtitle mb-0"><%= "No websites found. Start by adding a new monitor above." %></p>
        </div>
      <% else %>
        <% websites.each do |website| %>
          <div class="col-md-6 col-lg-4">
            <% failed = website.failed_responses_since_midnight? %>
            <div class="card site-card h-100 <%= 'failed' if failed %>">
              <div class="card-body">
                <div class="d-flex align-items-start justify-content-between">
                  <h5 class="card-title mb-0">
                    <%= link_to website.url, website_path(website), data: { turbo_frame: "_top" }, class: "stretched-link" %>
                  </h5>
                  <% if website.responses.any? %>
                    <span class="status-chip <%= failed ? 'status-chip--alert' : 'status-chip--ok' %>">
                      <%= failed ? "Attention" : "Stable" %>
                    </span>
                  <% end %>
                </div>

                <div class="site-card__meta">
                  <span><strong><%= "Responses" %></strong> <%= website.responses.count %></span>
                  <% if website.responses.any? %>
                    <span class="site-card__timestamp">
                      <%= "Last status #{website.latest_response.status_code}" %> Â·
                      <%= website.latest_response.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%b %d, %Y %l:%M %p") %>
                    </span>
                  <% else %>
                    <span class="site-card__timestamp"><%= "Awaiting first response." %></span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="d-flex justify-content-center mt-4">
      <%= paginate websites, params: { format: :turbo_stream, failed: params[:failed], q: params[:q] } %>
    </div>
  </section>
<% end %>
