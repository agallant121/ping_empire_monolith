<section class="surface-block">
  <div class="surface-header w-100">
    <div>
      <p class="surface-eyebrow"><%= t("websites.failures.eyebrow") %></p>
      <h1 class="surface-title"><%= t("websites.failures.title") %></h1>
      <p class="surface-subtitle"><%= t("websites.failures.subtitle") %></p>
    </div>
    <div class="ms-auto">
      <%= link_to t("websites.failures.back"), websites_path, class: "btn back-button" %>
    </div>
  </div>

  <% if @failed_websites_count.zero? %>
    <div class="stat-card stat-card--alert">
      <span class="stat-card__label"><%= t("websites.failures.status_label") %></span>
      <span class="stat-card__value"><%= t("websites.failures.all_clear") %></span>
      <p class="mb-0 surface-subtitle"><%= t("websites.failures.all_clear_subtitle") %></p>
    </div>
  <% else %>
    <div class="surface-toolbar">
      <%= form_with url: failures_websites_path, method: :get, class: "search-row", local: true do %>
        <div class="search-panel">
          <%= text_field_tag :q, params[:q], class: "search-input", placeholder: t("websites.summary.search_placeholder") %>
        </div>
        <%= submit_tag t("websites.summary.search"), class: "btn search-button" %>
      <% end %>
    </div>

    <div class="stat-grid mb-4">
      <div class="stat-card stat-card--alert stat-card--center">
        <span class="stat-card__label"><%= t("websites.failures.impacted_label") %></span>
        <span class="stat-card__value"><%= @failed_websites_count %></span>
        <p class="mb-0 surface-subtitle"><%= t("websites.failures.impacted_subtitle") %></p>
      </div>
      <div class="stat-card stat-card--center">
        <span class="stat-card__label"><%= t("websites.failures.failed_label") %></span>
        <span class="stat-card__value"><%= @failed_response_count %></span>
        <p class="mb-0 surface-subtitle"><%= t("websites.failures.failed_subtitle") %></p>
      </div>
      <div class="stat-card">
        <span class="stat-card__label"><%= t("websites.failures.observation_label") %></span>
        <span class="stat-card__value"><%= @cutoff_time.in_time_zone("Eastern Time (US & Canada)").strftime("%b %d, %Y") %></span>
        <p class="mb-0 surface-subtitle"><%= @cutoff_time.in_time_zone("Eastern Time (US & Canada)").strftime("%l:%M %p %Z") %></p>
      </div>
    </div>

    <%= render partial: "websites/failure_table", locals: { websites: @websites, failure_counts: @failure_counts, last_failure_at: @last_failure_at } %>
  <% end %>
</section>