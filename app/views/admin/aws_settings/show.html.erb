<% content_for :body_class, "admin-aws-settings" %>

<div class="container-sm">
  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="h4 mb-3"><%= "AWS Archive Settings" %></h1>
      <p class="text-muted"><%= "Provide the IAM credentials and bucket where CSV archives should be uploaded." %></p>

      <%= form_with model: [:admin, @aws_setting], url: admin_aws_settings_path, method: (@aws_setting.persisted? ? :patch : :post), class: "vstack gap-3" do |form| %>
        <div>
          <%= form.label :access_key_id, class: "form-label" %>
          <%= form.text_field :access_key_id, class: "form-control", autocomplete: "off", required: true %>
        </div>

        <div>
          <%= form.label :secret_access_key, class: "form-label" %>
          <%= form.password_field :secret_access_key, class: "form-control", autocomplete: "off", required: true %>
        </div>

        <div>
          <%= form.label :session_token, class: "form-label" %>
          <%= form.text_field :session_token, class: "form-control", autocomplete: "off" %>
          <div class="form-text"><%= "Optional. Only needed for temporary credentials." %></div>
        </div>

        <div>
          <%= form.label :region, class: "form-label" %>
          <%= form.text_field :region, class: "form-control", placeholder: "us-east-1", required: true %>
        </div>

        <div>
          <%= form.label :bucket, class: "form-label" %>
          <%= form.text_field :bucket, class: "form-control", required: true %>
        </div>

        <div>
          <%= form.label :key_prefix, class: "form-label" %>
          <%= form.text_field :key_prefix, class: "form-control", placeholder: "archives/optional-folder" %>
          <div class="form-text"><%= "Optional. We'll prepend this prefix to every uploaded CSV." %></div>
        </div>

        <% if @aws_setting.errors.any? %>
          <div class="alert alert-danger">
            <p class="mb-2"><%= "Please fix the following:" %></p>
            <ul class="mb-0">
              <% @aws_setting.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="d-flex align-items-center gap-3">
          <%= form.submit(@aws_setting.persisted? ? "Update AWS Settings" : "Save AWS Settings", class: "btn btn-primary") %>
          <%= link_to "Back to Archives", admin_archives_path, class: "btn btn-link" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
